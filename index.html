<?php
ob_start();
session_start();
?>

<html>

<head>
  <title>FUTABLES</title>
  <base href="/futables/">
  <link rel="stylesheet" type="text/css" href="css/main.css">
</head>

<?php include_once "include/index.php";?>

<body>

  <h1>FUTABLES</h1>

  <hr />

  <div id="header">
    <div id="header_hello">
      <?php
        if (isset($_SESSION["user_id"]))
          echo "Hello, $_SESSION[user_name].";
        else echo "Hello, Visitor.";
      ?>
    </div>
    <div id="header_login">
      <form method="POST" <?php echo $hideLogin;?>>
        <input type="text" name="username" placeholder="Username"
               value="<?php echo $username;?>">
        <input type="password" name="password" placeholder="Password">
        <input type="submit" value="LOG IN" name="login">
      </form>
    </div>
    <div id="header_logout">
      <form method="POST" <?php echo $hideLogout;?>>
        <input type="submit" value="LOG OUT" name="logout" />
      </form>
    </div>
    <div id="header_signup">
      <form method="POST" <?php echo $hideSignup;?> action="signup.html">
        <input type="submit" value="SIGN UP" name="signup_link" />
      </form>
    </div>
  </div>

  <hr <?php echo $hideManage;?>/>

  <div id="user_content">
    <?php if ($errMsg) echo "<hr /><p class='errMsg'>$errMsg</p>";?>
    <p <?php echo $hideManage;?>>
      <a href="manage.html">MANAGE YOUR LEAGUES</a>
    </p>
    <p <?php echo $hideManage;?>>
      <a href="tables.html">VIEW YOUR TABLES</a>
    </p>
    <p <?php echo $hideManage;?>>
      <a href="profile.html">EDIT PROFILE</a>
    </p>
  </div>

  <hr />

  <div id="latest_games">

    <h3>Latest games</h3>

    <?php

      $query = "SELECT *,
                       team_home.name as thName, team_away.name as taName,
                       leagues.name as league_name, users.name as user_name
                FROM games
                INNER JOIN teams team_home ON (games.home_id = team_home.id)
                INNER JOIN teams team_away ON (games.away_id = team_away.id)
                INNER JOIN leagues ON (games.league_id = leagues.id)
                INNER JOIN users ON (leagues.user_id = users.id)
                ORDER BY date
                LIMIT 5";
      $result = queryMysql($query);
      if (mysql_num_rows($result)) {
        echo "<table>";
        echo "<tr>
                <td>Home Team</td>
                <td>HG</td>
                <td>AG</td>
                <td>Away Team</td>
                <td>Competition</td>
                <td>User</td>
              </tr>";
        while ($row = mysql_fetch_assoc($result)) {
          //print_r($row);
          if ($row["home_goals"] == "" or $row["away_goals"] == "") continue;
          echo "<tr>
                  <td>$row[thName]</td>
                  <td>$row[home_goals]</td>
                  <td>$row[away_goals]</td>
                  <td>$row[taName]</td>
                  <td>$row[league_name]</td>
                  <td>$row[user_name]</td>
                </tr>";
        }
        echo "</table>";
      } else {
        echo "<p>There are no games in the database.</p>";
      }
    
    ?>

  </div>

  <hr />

  <div id="footer">
    <p>Hosted by <a href="http://www.zymic.com">zymic</a>.</p>
  </div>

</body>

</html>
